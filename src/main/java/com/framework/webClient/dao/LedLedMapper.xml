<?xml version="1.0" encoding="UTF-8" ?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" ><mapper namespace="com.framework.webClient.dao.LedLedDao" >	<!-- 查询电子站牌列表 -->	<select id="selectLedList" parameterType="map" resultType="map">		SELECT			t1."ledid" AS "ledid",			t1."ledmc" AS "ledmc",			t1."ledbh" AS "ledbh",			t1."ledfxbm" AS "ledfxbm",			t1."ledfx" AS "ledfx",			t1."ledmbid" AS "ledmbid",			t1."ledmbmc" AS "ledmbmc",			t1."zdsm" AS "zdsm",			CASE WHEN SUM (DISTINCT t1."zxzt") >= 1 THEN '在线' 	ELSE '离线' 	END AS "zxzt",			t1."jd" AS "jd",			t1."wd" AS "wd",			t1."bdsbipdz" AS "bdsbipdz",			t1."wg" AS "wg",			t1."zwym" AS "zwym",			t1."xgsj" AS "xgsj",			t1."qyzt" AS "qyzt",			MAX (t1."jssj") AS "jssj"		FROM			(				SELECT					ledLed.LEDID AS "ledid",					ledLed.LEDMC AS "ledmc",					ledLed.LEDBH AS "ledbh",					ledLed.LEDFX AS "ledfxbm",					ledSjzd.ZDMC AS "ledfx",					ledTempRel.MBID AS "ledmbid",					ledTemp.MBMC AS "ledmbmc",					(						SELECT							"COUNT" (*)						FROM							LED_STATION ledStation						WHERE							ledled.LEDID = ledStation.LEDID					) AS "zdsm",					CASE				WHEN ROUND (					TO_NUMBER (SYSDATE - ledState.JSSJ) * 24 * 60 * 60				) <![CDATA[ <= ]]> 180 THEN					1				ELSE					0				END AS "zxzt",				LEDLED.JD AS "jd",				LEDLED.WD AS "wd",				LEDLED.BDSBIPDZ AS "bdsbipdz",				LEDLED.WG AS "wg",				LEDLED.ZWYM AS "zwym",				LEDLED.XGSJ AS "xgsj",				ledState.JSSJ AS "jssj",				LEDLED.QYZT AS "qyzt"			FROM				LED_LED ledLed			JOIN LED_TEMPLATE_RELATION ledTempRel ON ledled.LEDID = ledTempRel.LEDID			JOIN LED_TEMPLATE ledTemp ON ledTempRel.MBID = ledTemp.MBID			left JOIN ${TABLENAME} ledState ON ledState.LEDBH = LEDLED.LEDBH			JOIN LED_SJZD ledSjzd ON ledSjzd.pzdbm = '15'			AND ledLed.LEDFX = ledSjzd.zdbm			) t1		<where>			<if test=" ledidList != null and  ledidList.size() > 0 ">				AND t1."ledid" in 				<foreach collection="ledidList" index="index" item="item" open="(" separator="," close=")">  			        '${item}'			    </foreach> 			</if>			<if test=" ledid != null and  ledid != '' ">				AND t1."ledid" = #{ledid}			</if>			<if test="ledmc != null and ledmc != ''">				AND	t1."ledmc" LIKE '%'||#{ledmc}||'%' 			</if>					<if test="ledbh != null and ledbh != ''">				AND t1."ledbh" LIKE '%'||#{ledbh}||'%' 			</if>			<if test="zxzt != null and zxzt != ''">				AND t1."zxzt" = #{zxzt}			</if>		</where>		GROUP BY			t1."ledid",			t1."ledmc",			t1."ledbh",			t1."ledfxbm",			t1."ledfx",			t1."ledmbid",			t1."ledmbmc",			t1."zdsm",			t1."jd",			t1."wd",			t1."bdsbipdz",			t1."wg",			t1."zwym",			t1."xgsj",			t1."qyzt"		ORDER BY			t1."xgsj" DESC					</select>				<!-- 查询电子站牌列表 (公交处增加站牌用)-->	<select id="selectLedListAdd" parameterType="map" resultType="map">			SELECT ledLed.LEDID AS "ledid",       ledLed.LEDMC AS "ledmc",       ledLed.LEDBH AS "ledbh",       ledLed.LEDFX AS "ledfxbm",       ledSjzd.ZDMC AS "ledfx",       ledTempRel.MBID AS "ledmbid",       ledTemp.MBMC AS "ledmbmc",       LEDLED.QYZT AS "qyzt"	  FROM LED_LED ledLed	  JOIN LED_TEMPLATE_RELATION ledTempRel ON ledled.LEDID = ledTempRel.LEDID	  JOIN LED_TEMPLATE ledTemp ON ledTempRel.MBID = ledTemp.MBID	  JOIN LED_SJZD ledSjzd ON ledSjzd.pzdbm = '15'	                       AND ledLed.LEDFX = ledSjzd.zdbm	  <if test="ledmc != null and ledmc != ''">		  AND ledLed.ledmc LIKE '%'||#{ledmc}||'%' 	  </if>			  <if test="ledbh != null and ledbh != ''">		  AND ledLed.ledbh LIKE '%'||#{ledbh}||'%' 	  </if>                     	</select>		<delete id="deleteLedByLedid" parameterType="map">		DELETE FROM LED_LED WHERE LEDID = #{ledid}			</delete>	<insert id="insertLedList" parameterType="map">		INSERT INTO LED_LED (			LEDID,			LEDMC,			LEDBH,			JD,			WD,			LEDFX,			BDSBIPDZ,			WG,			ZWYM,			BZ,			CJSJ,			CJR,			XGSJ,			XGR,			QYZT		)		VALUES		(			#{ledid},			#{ledmc},			#{ledbh},			#{jd},			#{wd},			#{ledfx},			#{bdsbipdz},			#{wg},			#{zwym},			#{bz},			SYSDATE,			#{cjr},			SYSDATE,			#{xgr},			#{qyzt}		)<!-- #{qyzt} -->	</insert>	<update id="updateLedList" parameterType="map">		UPDATE 			LED_LED		SET 		 	LEDMC = #{ledmc},		 	LEDBH = #{ledbh},			JD = #{jd},			WD = #{wd},			LEDFX = #{ledfx},			BDSBIPDZ = #{bdsbipdz},			WG = #{wg},			ZWYM = #{zwym},			XGSJ = SYSDATE,			XGR = #{xgr},			QYZT = #{qyzt}		WHERE			LEDID = #{ledid}	</update>	<!-- #{qyzt} -->	<select id="selectLedidAndLedmcBymcobh" parameterType="map" resultType="map">		SELECT			LEDLED.LEDID AS "ledid",			LEDLED.LEDMC AS "ledmc"		FROM			LED_LED ledled		<where>			<if test="ledmc != null and ledmc != ''">				AND	ledled.LEDMC LIKE '%'||#{ledmc}||'%' 			</if>					<if test="ledbh != null and ledbh != ''">				AND ledled.LEDBH LIKE '%'||#{ledbh}||'%' 			</if>			<if test="ledmc != null and ledmc != '' and tag != null and tag != ''">				AND	ledled.LEDMC = #{ledmc} 			</if>					<if test="ledbh != null and ledbh != '' and tag != null and tag != ''">				AND ledled.LEDBH = #{ledbh} 			</if>		</where>	</select>	<select id="selectLedbhByLedidList" parameterType="list" resultType="string">		SELECT			LEDLED.LEDBH AS "ledbh"		FROM			LED_LED ledled		where			ledled.ledid in 			<foreach collection="list" index="index" item="item" open="(" separator="," close=")">  		        '${item}'		    </foreach> 	</select>	<select id="selectLedbhAndIdByLedbhList" parameterType="list" resultType="map">		SELECT DISTINCT			LEDLED.LEDBH AS "ledbh",			LEDLED.LEDID AS "ledid"		FROM			LED_LED ledled		where			ledled.LEDBH in 			<foreach collection="list" index="index" item="item" open="(" separator="," close=")">  		        '${item}'		    </foreach>	</select>	<delete id="deleteLedInLedid" parameterType="list">		DELETE FROM LED_LED WHERE LEDID IN		<foreach item="item" collection="list" open="(" close=")"	separator=",">			#{item}		</foreach>			</delete>	<insert id="insertInLedList" parameterType="list">		INSERT INTO LED_LED (			LEDID,			LEDMC,			LEDBH,			JD,			WD,			LEDFX,			BDSBIPDZ,			WG,			ZWYM,			BZ,			CJSJ,			CJR,			XGSJ,			XGR,			QYZT		)		<foreach collection = "list" item = "map" index = "index" separator = "UNION ALL"> 			(				SELECT					#{map.ledid},					#{map.ledmc},					#{map.ledbh},					#{map.jd},					#{map.wd},					#{map.ledfx},					#{map.bdsbipdz},					#{map.wg},					#{map.zwym},					#{map.bz},					SYSDATE,					#{map.cjr},					SYSDATE,					#{map.xgr},					#{map.qyzt}				FROM				DUAL			)		</foreach>		</insert></mapper>